{% extends "base.html" %}

{% block title %}ãƒ›ãƒ¼ãƒ  - Django OIDC Challenge{% endblock %}

{% block content %}
<h2>Django OIDCèªè¨¼ã‚·ã‚¹ãƒ†ãƒ </h2>

{% if user.is_authenticated %}
    <div class="user-info">
        <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±</h3>
        <p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</strong> {{ user.username }}</p>
        <p><strong>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</strong> {{ user.email }}</p>
        <p><strong>å§“å:</strong> {{ user.get_full_name|default:"æœªè¨­å®š" }}</p>
        <p><strong>æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³:</strong> {{ user.last_login|default:"åˆå›ãƒ­ã‚°ã‚¤ãƒ³" }}</p>
        <p><strong>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ—¥:</strong> {{ user.date_joined }}</p>
    </div>

    <div class="alert alert-info">
        <strong>èªè¨¼æˆåŠŸï¼</strong> OIDCèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’é€šã˜ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã™ã€‚
    </div>

    <h3>åˆ©ç”¨å¯èƒ½ãªæ©Ÿèƒ½</h3>
    <ul>
        <li>KeyCloakçµŒç”±ã§ã®Googleèªè¨¼</li>
        <li>AWS OIDCèªè¨¼ï¼ˆè¨­å®šæ¸ˆã¿ã®å ´åˆï¼‰</li>
        <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†</li>
        <li>ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</li>
    </ul>

{% else %}
    <div class="alert alert-info">
        <strong>èªè¨¼ãŒå¿…è¦ã§ã™ã€‚</strong> ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚
    </div>

    <h3>ãƒ­ã‚°ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³</h3>
    <p>ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã™ï¼š</p>

    <div class="provider-buttons">
        {% load socialaccount %}
        
        {% get_providers as socialaccount_providers %}
        {% for provider in socialaccount_providers %}
            {% if provider.id == "openid_connect" %}
                {% for app in provider.get_app_configs %}
                    {% if app.provider_id == "keycloak" %}
                        <a href="{% provider_login_url provider.id openid_connect=app.provider_id %}" class="provider-btn keycloak">
                            <strong>ğŸ” KeyCloakçµŒç”±ã§ãƒ­ã‚°ã‚¤ãƒ³</strong>
                            <small style="margin-left: 10px; color: #666;">ï¼ˆGoogleèªè¨¼ã‚’å«ã‚€ï¼‰</small>
                        </a>
                    {% elif app.provider_id == "aws-oidc" %}
                        <a href="{% provider_login_url provider.id openid_connect=app.provider_id %}" class="provider-btn aws">
                            <strong>â˜ï¸ AWS OIDC ã§ãƒ­ã‚°ã‚¤ãƒ³</strong>
                            <small style="margin-left: 10px; color: #666;">ï¼ˆAWS IAM Identity Centerï¼‰</small>
                        </a>
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endfor %}
    </div>

    <h3>èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦</h3>
    <ul>
        <li><strong>KeyCloak:</strong> Identity Brokerã¨ã—ã¦æ©Ÿèƒ½ã—ã€Google OAuth2èªè¨¼ã‚’ä»²ä»‹</li>
        <li><strong>AWS OIDC:</strong> AWS IAM Identity Centerã¨ã®ç›´æ¥çµ±åˆ</li>
        <li><strong>django-allauth:</strong> Djangoç”¨ã®åŒ…æ‹¬çš„ãªèªè¨¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</li>
        <li><strong>python-keycloak:</strong> KeyCloakç®¡ç†APIæ“ä½œ</li>
    </ul>
{% endif %}

<h3>æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯</h3>
<ul>
    <li>Django 5.2.4</li>
    <li>django-allauth 0.63.6</li>
    <li>python-keycloak 3.17.0</li>
    <li>KeyCloak (Docker)</li>
    <li>PostgreSQL</li>
</ul>
{% endblock %}
